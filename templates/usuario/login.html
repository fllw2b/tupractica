{% extends 'base/base.html' %}

{% block contenido %}
<form method="post">
    {% csrf_token %}
    <input type="email" id="email" name="email" placeholder="Correo electrónico" required>
    <input type="password" id="password" name="password" placeholder="Contraseña" required>
    <button type="button" onclick="iniciarSesion()">Ingresar</button>
</form>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-auth.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-analytics.js";

    const firebaseConfig = {
        apiKey: "AIzaSyBRayT10WyWqcRzHuU2MSWCigidfIK8fK0",
        authDomain: "djangotupractica.firebaseapp.com",
        projectId: "djangotupractica",
        storageBucket: "djangotupractica.appspot.com",
        messagingSenderId: "464191195944",
        appId: "1:464191195944:web:6d72d0de73995a4afa1e1d",
        measurementId: "G-PVL5B5XLSW"
    };

    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    const auth = getAuth(app);

    function iniciarSesion() {
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;

        firebase.auth().signInWithEmailAndPassword(email, password)
            .then((userCredential) => {
                return userCredential.user.getIdToken().then((idToken) => {
                    fetch('/login/', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded',
                        },
                        body: 'id_token=' + idToken
                    }).then(response => {
                        if (response.ok) {
                            window.location.href = "/";
                        }
                    });
                });
            })
            .catch((error) => {
                console.error('Error al iniciar sesión:', error);
            });
    }
</script>

{% endblock %}